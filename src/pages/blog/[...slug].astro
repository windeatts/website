---
import { getCollection, render } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  return allPosts.map((post) => ({
    params: { slug: post.id },
    props: { postId: post.id },
  }));
}

const { postId } = Astro.props;
const allPosts = await getCollection('blog');
const post = allPosts.find((p) => p.id === postId)!;
const { Content } = await render(post);
---

<PageLayout
  title={post.data.title}
  description={post.data.summary}
  breadcrumbs={[{ label: 'Blog', href: '/blog' }, { label: post.data.title }]}
>
  <article class="max-w-3xl mx-auto">
    <!-- Article meta -->
    <div class="mb-8 pb-8 border-b border-gray-200">
      <time
        datetime={post.data.date.toISOString()}
        class="text-sm text-gray-500"
      >
        {post.data.date.toLocaleDateString('en-GB', {
          day: 'numeric',
          month: 'long',
          year: 'numeric',
        })}
      </time>
      {post.data.author && (
        <p class="mt-1 text-sm text-gray-600">By {post.data.author}</p>
      )}
      {post.data.tags.length > 0 && (
        <div class="mt-3 flex flex-wrap gap-2">
          {post.data.tags.map((tag) => (
            <span class="inline-block bg-navy/5 text-navy text-xs font-medium px-2.5 py-0.5 rounded-full">
              {tag}
            </span>
          ))}
        </div>
      )}
    </div>

    <!-- Article body -->
    <div class="prose prose-lg max-w-none prose-headings:font-(family-name:--font-heading) prose-headings:text-navy prose-a:text-gold prose-a:no-underline hover:prose-a:underline">
      <Content />
    </div>

    <!-- Back link -->
    <div class="mt-12 pt-8 border-t border-gray-200">
      <a
        href="/blog"
        class="inline-flex items-center text-sm font-medium text-gold hover:text-gold-dark transition-colors"
      >
        <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to all posts
      </a>
    </div>
  </article>
</PageLayout>
