---
interface Props {
  compact?: boolean;
}

const { compact = false } = Astro.props;

// TODO: Replace with real Formspree form ID
// Create a free account at https://formspree.io and create a form
// that forwards to enquiry@windeatts.co.uk
const FORMSPREE_ID = import.meta.env.PUBLIC_FORMSPREE_ID || 'YOUR_FORM_ID';
---

<form
  id="contact-form"
  action={`https://formspree.io/f/${FORMSPREE_ID}`}
  method="POST"
  class:list={['space-y-4', compact ? 'max-w-md' : 'max-w-2xl']}
>
  <div class:list={[compact ? 'space-y-4' : 'grid grid-cols-1 sm:grid-cols-2 gap-4']}>
    <div>
      <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
      <input
        type="text"
        id="name"
        name="name"
        required
        class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gold focus:border-gold transition-colors"
      />
    </div>
    <div>
      <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gold focus:border-gold transition-colors"
      />
    </div>
  </div>

  <div>
    <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
    <input
      type="tel"
      id="phone"
      name="phone"
      class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gold focus:border-gold transition-colors"
    />
  </div>

  {!compact && (
    <div>
      <label for="service" class="block text-sm font-medium text-gray-700 mb-1">How can we help?</label>
      <select
        id="service"
        name="service"
        class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gold focus:border-gold transition-colors bg-white"
      >
        <option value="">Please select...</option>
        <optgroup label="Services for You">
          <option>Buying or Selling a Property</option>
          <option>Co-owning Property</option>
          <option>Remortgage & Equity Release</option>
          <option>Probate & Estate Administration</option>
          <option>Probate Disputes</option>
          <option>Services for the Older Client</option>
          <option>Trust Funds & Inheritance Tax</option>
          <option>Wills, Powers of Attorney & Living Wills</option>
          <option>Clinical Negligence</option>
          <option>Personal Injury Law</option>
          <option>Family Law</option>
        </optgroup>
        <optgroup label="Services for Business">
          <option>Buying or Selling a Business</option>
          <option>Commercial Property</option>
          <option>Contract & Commercial Litigation</option>
          <option>Domestic & Commercial Property Disputes</option>
        </optgroup>
        <option value="other">Other</option>
      </select>
    </div>
  )}

  <div>
    <label for="message" class="block text-sm font-medium text-gray-700 mb-1">Message *</label>
    <textarea
      id="message"
      name="message"
      required
      rows={compact ? 3 : 5}
      class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gold focus:border-gold transition-colors resize-y"
    ></textarea>
  </div>

  <button
    type="submit"
    id="submit-btn"
    class="bg-gold hover:bg-gold/90 text-navy font-semibold px-6 py-3 rounded-lg transition-colors text-sm"
  >
    Send Enquiry
  </button>

  <div id="form-status" class="hidden text-sm rounded-lg p-4"></div>

  <p class="text-xs text-gray-500">
    By submitting this form, you agree to our <a href="/privacy-policy" class="underline hover:text-navy">privacy policy</a>.
    We will use your information to respond to your enquiry. Our general response time is one business day.
  </p>
</form>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const status = document.getElementById('form-status')!;
  const btn = document.getElementById('submit-btn') as HTMLButtonElement;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    btn.disabled = true;
    btn.textContent = 'Sending...';
    status.className = 'hidden';

    try {
      const res = await fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
        headers: { Accept: 'application/json' },
      });

      if (res.ok) {
        status.textContent = 'Thank you for your enquiry. We will be in touch within one business day.';
        status.className = 'text-sm rounded-lg p-4 bg-green-50 text-green-800 border border-green-200';
        form.reset();
      } else {
        throw new Error('Form submission failed');
      }
    } catch {
      status.textContent = 'Sorry, there was a problem sending your message. Please call us on 01548 852727 or email enquiry@windeatts.co.uk.';
      status.className = 'text-sm rounded-lg p-4 bg-red-50 text-red-800 border border-red-200';
    } finally {
      btn.disabled = false;
      btn.textContent = 'Send Enquiry';
    }
  });
</script>
